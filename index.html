<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>酒店评论</title>
  <style>
    :root{
      --bg:#f8f9fa;
      --card:#ffffff;
      --text:#212529;
      --sub:#6c757d;
      --brand:#9c6bff;
      --muted:#dee2e6;
      --accent:#28a745;
      --danger:#dc3545;
      --gutter: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--text); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial;}
    .app{max-width:520px; margin:0 auto; min-height:100%; display:flex; flex-direction:column}
    header{position:sticky; top:0; z-index:10; background:#fff; border-bottom:1px solid var(--muted);}
    .safe{padding: env(safe-area-inset-top) env(safe-area-inset-right) 0 env(safe-area-inset-left)}
    .head{display:flex; align-items:center; gap:12px; padding:14px calc(var(--gutter) + env(safe-area-inset-right)) 12px calc(var(--gutter) + env(safe-area-inset-left));}
    .logo{width:40px; height:40px; border-radius:12px; background:var(--brand); display:grid; place-items:center; color:#fff; font-weight:700}
    .title-wrap{flex:1}
    h1{margin:0; font-size:18px}
    .meta{font-size:12px; color:var(--sub); display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .star{color:#ffc107}

    main{padding:8px calc(var(--gutter) + env(safe-area-inset-right)) 24px calc(var(--gutter) + env(safe-area-inset-left));}

    .filter{display:flex; gap:8px; padding:8px calc(var(--gutter) + env(safe-area-inset-right)) 12px calc(var(--gutter) + env(safe-area-inset-left)); overflow:auto; scrollbar-width:none; scroll-padding-left: calc(var(--gutter) + env(safe-area-inset-left));}
    .chip{padding:8px 12px; font-size:12px; border:1px solid var(--muted); border-radius:999px; color:var(--sub); background:#f8f9fa; cursor:pointer; white-space:nowrap}
    .chip.active{border-color:var(--brand); color:var(--brand); background:#e9f5ff}

    .card{background:var(--card); border:1px solid var(--muted); border-radius:16px; padding:12px; margin:10px 0; box-shadow:0 2px 6px rgba(0,0,0,0.05)}
    .row{display:flex; gap:12px}
    .avatar{width:40px; height:40px; border-radius:50%; background:#e9ecef; display:grid; place-items:center; color:#495057; font-weight:700}
    .who{flex:1}
    .who .name{font-size:14px; font-weight:600}
    .who .sub{font-size:12px; color:var(--sub)}
    .who .tags{margin-top:4px; display:flex; flex-wrap:wrap; gap:6px}
    .tag{font-size:10px; padding:4px 8px; border-radius:999px; border:1px solid var(--muted); color:#6c757d}

    .pill{display:inline-flex; align-items:center; gap:4px; padding:2px 8px; border-radius:999px; border:1px solid var(--muted); background:#f8f9fa; font-size:11px}

    .audio{margin-top:10px; background:#f1f3f5; border:1px solid var(--muted); border-radius:14px; padding:10px; position:relative}
    .controls{display:flex; align-items:center; gap:10px}
    .play{width:36px; height:36px; border-radius:50%; border:none; outline:none; display:grid; place-items:center; background:var(--brand); color:#fff; cursor:pointer}
    .play svg{width:18px; height:18px; display:block; transform: translateX(1px);} /* 光学居中 */
    .play[disabled]{opacity:.5; cursor:not-allowed}

    .track{flex:1}
    .bar{height:6px; border-radius:999px; background:#dee2e6; overflow:hidden; position:relative}
    .prog{height:100%; width:0%; background:linear-gradient(90deg, var(--accent), var(--brand))}
    .time{display:flex; justify-content:space-between; font-size:10px; color:var(--sub); margin-top:6px}

    .status{font-size:12px; color:var(--sub)}
    .status.missing{color:var(--danger)}

    /* 图片区域 */
    .photos{margin-top:10px}
    .grid{display:grid; grid-template-columns:repeat(3, 1fr); gap:6px}
    .thumb{width:100%; aspect-ratio:1/1; border-radius:10px; border:1px solid var(--muted); background:#f8f9fa; overflow:hidden; position:relative; cursor:pointer}
    .thumb img{width:100%; height:100%; object-fit:cover; display:block}

    /* 全屏图片查看 */
    .viewer{position:fixed; inset:0; background:rgba(0,0,0,.75); display:none; align-items:center; justify-content:center; z-index:50}
    .viewer img{max-width:92vw; max-height:86vh; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.4)}
    .viewer.show{display:flex}

    footer{color:var(--sub); font-size:12px; text-align:center; padding:24px 8px 32px}
    .spacer{height: env(safe-area-inset-bottom)}
  </style>
</head>
<body>
  <div class="app">
    <header class="safe">
      <div class="head">
        <div class="logo" aria-hidden="true">🏨</div>
        <div class="title-wrap">
          <h1>T101酒店</h1>
          <div class="meta">
            <span class="star">★ ★ ★ ★ ☆</span>
            <span>4.3 · 1,028 条评论</span>
            <span>·</span>
            <span class="pill">地铁200m</span>
            <span class="pill">免费停车</span>
            <span class="pill">免费取消</span>
          </div>
        </div>
      </div>
      <div class="filter" role="tablist" aria-label="筛选">
        <div class="chip active" role="tab" aria-selected="true" data-key="all">全部</div>
      </div>
    </header>

    <main id="list"></main>
  </div>

  <!-- 图片查看器 -->
  <div class="viewer" id="viewer" aria-hidden="true">
    <img alt="预览" id="viewerImg" />
  </div>

  <template id="card-tpl">
    <article class="card" data-id="">
      <div class="row">
        <div class="avatar" aria-hidden="true">👤</div>
        <div class="who">
          <div class="name">住客</div>
          <div class="sub">
            <span class="date">2025-09-17</span>
            · <span class="stars">★★★★★</span>
          </div>
          <div class="tags"></div>
        </div>
      </div>

      <div class="audio" role="group" aria-label="语音评论">
        <div class="controls">
          <button class="play" aria-label="播放" title="播放">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 5v14l11-7z" fill="currentColor"/></svg>
          </button>
          <div class="track">
            <div class="bar"><div class="prog"></div></div>
            <div class="time"><span class="cur">00:00</span><span class="dur">--:--</span></div>
          </div>
        </div>
        <div class="status missing">未上传音频</div>
      </div>

      <!-- 图片区域（若无图片将自动隐藏） -->
      <div class="photos">
        <div class="grid"></div>
      </div>
    </article>
  </template>

  <script>
    // ================ 数据（示例：按酒店场景重写） ================
    // tagKeys: family / business / transport / quiet / breakfast / onsen
    const reviews = [
      { id:1,  name:"住客 A", date:"2025-09-17", stars:"★★★★★", tags:[], tagKeys:["transport"], audioSrc:"voice/1.m4a", durationHint:null, photos:["image/1-1.jpg","image/1-2.jpg","image/1-3.jpg"] },
      { id:2,  name:"住客 B", date:"2025-09-10", stars:"★★★★☆", tags:[], tagKeys:["transport","breakfast"], audioSrc:"voice/2.m4a", durationHint:null, photos:["image/2-1.jpg","image/2-2.jpg","image/2-3.jpg"] },
      { id:3,  name:"住客 C", date:"2025-09-04", stars:"★★★☆☆", tags:[], tagKeys:["quiet"], audioSrc:"voice/3.m4a", durationHint:null, photos:["image/3-1.jpg","image/3-2.jpg","image/3-3.jpg"] },
      { id:4,  name:"住客 D", date:"2025-08-19", stars:"★★★★★", tags:[], tagKeys:["family"], audioSrc:"voice/4.m4a", durationHint:null, photos:["image/4-1.jpg","image/4-2.jpg","image/4-3.jpg"] },
      { id:5,  name:"住客 E", date:"2025-08-18", stars:"★☆☆☆☆", tags:[], tagKeys:["business"], audioSrc:"voice/5.m4a", durationHint:null, photos:["image/5-1.jpg","image/5-2.jpg","image/5-3.jpg"] },
      { id:6,  name:"住客 F", date:"2025-08-18", stars:"★★★★☆", tags:[], tagKeys:[], audioSrc:"voice/6.m4a", durationHint:null, photos:["image/6-1.jpg","image/6-2.jpg","image/6-3.jpg"] },
      { id:7,  name:"住客 G", date:"2025-08-08", stars:"★★★★★", tags:[], tagKeys:[], audioSrc:"voice/7.m4a", durationHint:null, photos:["image/7-1.jpg","image/7-2.jpg"] },
      { id:8,  name:"住客 H", date:"2025-08-03", stars:"★★★★☆", tags:[], tagKeys:["onsen"], audioSrc:"voice/8.m4a", durationHint:null, photos:["image/8-1.jpg","image/8-2.jpg"] },
      { id:9,  name:"住客 I", date:"2025-08-02", stars:"★★★☆☆", tags:[], tagKeys:["business"], audioSrc:"voice/9.MP3", durationHint:null, photos:["image/9-1.jpg","image/9-2.jpg","image/9-3.jpg"] },
      { id:10, name:"住客 J", date:"2025-08-02", stars:"★★★★★", tags:[], tagKeys:["quiet"], audioSrc:"voice/10.m4a", durationHint:null, photos:["image/10-1.jpg","image/10-2.jpg"] }
    ];

    // 工具：将秒数格式化为 mm:ss
    const fmt = s=>{ if(!Number.isFinite(s)) return "--:--"; const m=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(Math.floor(s%60)).padStart(2,'0'); return `${m}:${ss}`; };

    const $list = document.getElementById('list');
    const tpl = document.getElementById('card-tpl');
    const filterBar = document.querySelector('.filter');

    let currentAudio = null; // 确保同一时间只有一个在播
    let curFilter = 'all';

    function createCard(data){
      const node = tpl.content.cloneNode(true);
      const card = node.querySelector('.card');
      card.dataset.id = data.id;
      card.dataset.tagKeys = (data.tagKeys||[]).join(',');
      card.querySelector('.name').textContent = data.name;
      card.querySelector('.date').textContent = data.date;
      card.querySelector('.stars').textContent = data.stars;
      const tagsWrap = card.querySelector('.tags');
      data.tags.forEach(t=>{ const span=document.createElement('span'); span.className='tag'; span.textContent=t; tagsWrap.appendChild(span); });

      // 音频
      const playBtn = card.querySelector('.play');
      const curEl = card.querySelector('.cur');
      const durEl = card.querySelector('.dur');
      const progEl = card.querySelector('.prog');
      const statusEl = card.querySelector('.status');

      const audio = new Audio();
      audio.preload = 'metadata';
      if(data.audioSrc){ audio.src = data.audioSrc; }

      const noAudio = !data.audioSrc;
      playBtn.disabled = noAudio;
      statusEl.classList.toggle('missing', noAudio);
      statusEl.textContent = noAudio ? '未上传音频' : '可播放';
      if(data.durationHint) durEl.textContent = fmt(data.durationHint);

      // 元数据加载
      audio.addEventListener('loadedmetadata', ()=>{ durEl.textContent = fmt(audio.duration); });

      function pauseOthers(){
        if(currentAudio && currentAudio!==audio){ currentAudio.pause(); currentAudio.__btn && (currentAudio.__btn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z" fill="currentColor"/></svg>'); }
        currentAudio = audio; currentAudio.__btn = playBtn;
      }

      // 播放/暂停
      playBtn.addEventListener('click', async ()=>{
        if(audio.paused){
          pauseOthers();
          try{ await audio.play(); playBtn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M6 4h4v16H6zM14 4h4v16h-4z" fill="currentColor"/></svg>'; }
          catch(e){ console.warn(e); }
        } else { audio.pause(); playBtn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z" fill="currentColor"/></svg>'; }
      });

      // 进度与结束
      audio.addEventListener('timeupdate', ()=>{ curEl.textContent = fmt(audio.currentTime); const ratio = audio.duration? (audio.currentTime / audio.duration) : 0; progEl.style.width = `${(ratio*100).toFixed(2)}%`; });
      audio.addEventListener('ended', ()=>{ playBtn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z" fill="currentColor"/></svg>'; progEl.style.width='0%'; curEl.textContent='00:00'; });

      // 点击进度条跳转
      const bar = card.querySelector('.bar');
      bar.addEventListener('click', (e)=>{ if(!audio.duration) return; const rect = bar.getBoundingClientRect(); const ratio = (e.clientX - rect.left)/rect.width; audio.currentTime = Math.max(0, Math.min(audio.duration, ratio*audio.duration)); });

      // 图片
      const photosWrap = card.querySelector('.photos');
      const grid = card.querySelector('.photos .grid');
      if(Array.isArray(data.photos) && data.photos.length){
        data.photos.forEach((src,idx)=>{
          const box = document.createElement('div');
          box.className = 'thumb';
          const img = document.createElement('img');
          img.alt = `图片${idx+1}`; img.src = src;
          box.appendChild(img);
          box.addEventListener('click', ()=> openViewer(src));
          grid.appendChild(box);
        });
      } else {
        photosWrap.style.display = 'none';
      }

      return node;
    }

    // 渲染列表（带筛选）
    const $cards = [];
    function render(){
      $list.innerHTML = '';
      reviews.forEach(r=>{
        if(curFilter==='all' || (r.tagKeys||[]).includes(curFilter)){
          const frag = createCard(r);
          $list.appendChild(frag);
        }
      });
    }

    // 处理筛选点击
    filterBar.addEventListener('click', (e)=>{
      const item = e.target.closest('.chip');
      if(!item) return;
      document.querySelectorAll('.chip').forEach(ch=>ch.classList.remove('active'));
      item.classList.add('active');
      curFilter = item.dataset.key || 'all';
      render();
    });

    // 初始渲染
    render();

    // 简易图片查看器
    const viewer = document.getElementById('viewer');
    const viewerImg = document.getElementById('viewerImg');
    function openViewer(src){ viewerImg.src = src; viewer.classList.add('show'); viewer.setAttribute('aria-hidden','false'); }
    viewer.addEventListener('click', ()=>{ viewer.classList.remove('show'); viewer.setAttribute('aria-hidden','true'); viewerImg.removeAttribute('src'); });

    // 使用说明：
    // 1）替换头部酒店信息（名称、位置、价格）；
    // 2）在 reviews 中填入住客语音与房型/设施照片；
    // 3）用 tagKeys 让该条评论出现在对应筛选下（family/business/transport/quiet/breakfast/onsen）。
  </script>
</body>
</html>

